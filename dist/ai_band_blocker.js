(async()=>{for(;!Spicetify.React||!Spicetify.ReactDOM;)await new Promise(e=>setTimeout(e,10));var e;e=async function(){for(;null==Spicetify||!Spicetify.Player||null==Spicetify||!Spicetify.Menu||null==Spicetify||!Spicetify.LocalStorage;)await new Promise(e=>setTimeout(e,100));let p={url:"https://raw.githubusercontent.com/xoundbyte/soul-over-ai/main/dist/artists.json",cacheKey:"ai-bands:list",timeKey:"ai-bands:ts",enabledKey:"ai-bands:enabled",allowLikedKey:"ai-bands:allowLiked",tagSkipStatesKey:"ai-bands:tagSkipStates",showAITagsKey:"ai-bands:showAITags",labelAISongsKey:"ai-bands:labelAISongs",ttl:864e5};(I=document.createElement("style")).textContent=`
    .ai-band-tag {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background-color: #5bcefa;
      color: #000;
      font-size: 10px;
      font-weight: 700;
      padding: 2px 5px;
      border-radius: 3px;
      margin-left: 4px;
      vertical-align: middle;
      line-height: 1;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .ai-band-tag-header {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background-color: #5bcefa;
      color: #000;
      font-size: 24px;
      font-weight: 700;
      padding: 4px 10px;
      border-radius: 6px;
      margin-left: 12px;
      vertical-align: middle;
      line-height: 1;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      position: relative;
      z-index: 10;
    }
    .ai-song-label {
      color: #5bcefa !important;
      font-size: 11px;
      font-weight: 600;
      margin-left: 8px;
      white-space: nowrap;
    }
  `,document.head.appendChild(I);let e,g=new Map,y=new Map,u=new Map,S=new Set,o="false"!==Spicetify.LocalStorage.get(p.enabledKey),r="true"===Spicetify.LocalStorage.get(p.allowLikedKey),m="false"!==Spicetify.LocalStorage.get(p.showAITagsKey),l="false"!==Spicetify.LocalStorage.get(p.labelAISongsKey),t=null;function h(e){var t;return e?(t=(e=e.trim()).match(/^[a-zA-Z0-9]{22}$/))?t[0]:(t=e.match(/artist[\/:]([a-zA-Z0-9]+)/))?t[1]:null:null}function s(e){return g.has(e)}function c(){var e=document.createElement("span");return e.className="ai-band-tag",e.textContent="AI",e.setAttribute("data-ai-tag","true"),e}function w(){if(m){var t,i=document.querySelectorAll('a[href*="/artist/"]');let e=null;for(t of Array.from(document.querySelectorAll('a[href*="/artist/"]')))if("show all"===(null==(a=t.textContent)?void 0:a.trim().toLowerCase())){var a=h(t.href);if(a){e=a;break}}i.forEach(i=>{var a=i,n=h(a.href);if(n){var e=i.querySelector(".ai-band-tag"),t=null!=(t=null==(t=i.nextElementSibling)?void 0:t.classList)&&t.contains("ai-band-tag")?i.nextElementSibling:null;if(s(n)){if(!e&&!t){var n=y.get(n);let e=a,t=15;for(;--t&&e.childNodes[0];)e=e.childNodes[0];var a=(null==(a=e.textContent)?void 0:a.trim())||"";/Discovered On|Discovery|You've liked|Show all/i.test(a)||n&&a.toLowerCase()!==n.toLowerCase()||(a=c(),"listRowTitle"==(null==(n=null==(n=null==e?void 0:e.parentElement)?void 0:n.parentElement)?void 0:n.dataset.encoreId)&&"a"===(null==(n=null==(n=null==(n=null==e?void 0:e.parentElement)?void 0:n.parentElement)?void 0:n.parentElement)?void 0:n.tagName.toLowerCase())?(e.parentElement.parentElement.parentElement.style.display="inline-flex",i.appendChild(a)):null!=(n=null==(n=i.parentElement)?void 0:n.classList)&&n.contains("encore-text")||i.closest('[data-testid="tracklist-row"]')||i.closest('[data-testid="track-row"]')||i.closest(".main-trackList-trackListRow")?null!=(n=i.parentElement)&&n.insertBefore(a,i.nextSibling):i.appendChild(a))}}else e&&e.remove(),t&&t.remove()}});var n,i=document.querySelector(".main-entityHeader-title h1, .main-entityHeader-title");!i||i.querySelector(".ai-band-tag")||i.querySelector(".ai-band-tag-header")||e&&s(e)&&((n=c()).classList.remove("ai-band-tag"),n.classList.add("ai-band-tag-header"),i.appendChild(n),i.style.marginBottom="12px",i.style.display="flex",i.style.flexWrap="wrap",i.style.alignItems="center",i.style.gap="12px",n=i.querySelector('[data-encore-id="adaptiveTitle"]'))&&(i=parseFloat(n.style.fontSize)||96,n.style.fontSize=.85*i+"px"),l&&document.querySelectorAll('[data-testid="tracklist-row"], [data-testid="track-row"], .main-trackList-trackListRow, [role="row"][aria-rowindex]').forEach(e=>{if(!e.querySelector(".ai-song-label")){var a,n,o=e.querySelectorAll('a[href*="/artist/"]');let t=!1,i=new Set;o.forEach(e=>{e=h(e.href);e&&s(e)&&(e&&i.add(e),t=!0)}),t&&(e=null==(o=e.querySelector(".main-trackList-rowMainContent"))?void 0:o.querySelector(".encore-text-body-medium"))&&o&&((o=document.createElement("div")).style.display="flex",o.style.alignItems="center",(n=document.createElement("span")).className="ai-song-label",n.textContent="AI Artist",n.setAttribute("data-ai-song-label","true"),n.style.flexShrink="0",n=n,a=e.cloneNode(!0),o.appendChild(a),o.appendChild(n),e.replaceWith(o))}})}}function b(){document.querySelectorAll(".ai-band-tag, .ai-song-label").forEach(e=>e.remove())}function A(){document.querySelectorAll(".ai-band-tag").forEach(e=>e.remove())}function i(){t&&t.disconnect();let e=null;(t=new MutationObserver(()=>{e&&clearTimeout(e),e=setTimeout(()=>{w()},100)})).observe(document.body,{childList:!0,subtree:!0}),w()}function v(){var e=Object.fromEntries(u);Spicetify.LocalStorage.set(p.tagSkipStatesKey,JSON.stringify(e))}if(I=Spicetify.LocalStorage.get(p.tagSkipStatesKey))try{var a=JSON.parse(I);u=new Map(Object.entries(a))}catch(e){console.error("[AI Blocker] Failed to parse tag skip states",e)}let n=[],f;async function d(e){var t=Date.now(),i=Spicetify.LocalStorage.get(p.timeKey),i=i?parseInt(i):0,a=Spicetify.LocalStorage.get(p.cacheKey);let n=[];if(a&&e)try{n=JSON.parse(a)}catch(e){console.error("[AI Blocker] Cache parse error",e)}if(e||t-i>p.ttl||0===n.length){console.log("[AI Blocker] Fetching new blocklist...");try{var o=await fetch(p.url);if(!o.ok)throw new Error("HTTP error! status: "+o.status);0<(n=await o.json()).length&&(Spicetify.LocalStorage.set(p.cacheKey,JSON.stringify(n)),Spicetify.LocalStorage.set(p.timeKey,t.toString()),console.log(`[AI Blocker] Updated cache with ${n.length} artists.`))}catch(e){console.error("[AI Blocker] Fetch failed, using cached data if available.",e)}}g.clear(),y.clear();var r,l,s=new Set;for(r of n){let e,t=[],i=null;if("string"!=typeof r&&("object"==typeof r&&r.name)){e=r.name,t=Array.isArray(r.tags)?r.tags:[];var c=h(i=r.spotify||null);if(c){g.set(c,t),y.set(c,e);for(var f of t)s.add(f)}}}let d=!1;for(l of S=s)u.has(l)||(u.set(l,!0),d=!0);d&&v(),k(),m&&(A(),b(),w())}function k(){n=[];var e=Array.from(u.keys()).filter(e=>S.has(e)).sort();for(let i of e){var t=null==(t=u.get(i))||t,t=new Spicetify.Menu.Item("Skip: "+i,t,e=>{var t=!u.get(i);u.set(i,t),v(),e.setState(t),Spicetify.showNotification(`Tag "${i}" `+(t?"will be skipped":"allowed")),t&&o&&B()});n.push(t)}f&&(f.deregister(),(f=new Spicetify.Menu.SubMenu("AI Filter Tags",n)).register())}await d(!1),setInterval(()=>{console.log("[AI Blocker] Running scheduled ban list update..."),d(!1)},p.ttl),k(),f=new Spicetify.Menu.SubMenu("AI Filter Tags",n);var I=new Spicetify.Menu.Item("Block AI Bands",o,e=>{o=!o,Spicetify.LocalStorage.set(p.enabledKey,o.toString()),e.setState(o),Spicetify.showNotification("AI Blocking "+(o?"ON":"OFF")),o&&B()}),a=new Spicetify.Menu.Item("Allow Liked AI Songs",r,e=>{r=!r,Spicetify.LocalStorage.set(p.allowLikedKey,r.toString()),e.setState(r),Spicetify.showNotification("Allow Liked AI Songs "+(r?"ON":"OFF"))}),x=new Spicetify.Menu.Item("Label AI Artists",m,e=>{m=!m,Spicetify.LocalStorage.set(p.showAITagsKey,m.toString()),e.setState(m),Spicetify.showNotification("AI Tags "+(m?"ON":"OFF")),(m?i:(t&&(t.disconnect(),t=null),A(),b))()}),L=new Spicetify.Menu.Item("Label AI Songs",l,e=>{l=!l,Spicetify.LocalStorage.set(p.labelAISongsKey,l.toString()),e.setState(l),Spicetify.showNotification("AI Song Labels "+(l?"ON":"OFF")),l?w():document.querySelectorAll(".ai-song-label").forEach(e=>e.remove())}),E=new Spicetify.Menu.Item("Update Blocklist",!1,async()=>{var t;Spicetify.showNotification("Updating blocklist..."),await d(!0),t=200,await new Promise(e=>setTimeout(e,t)),Spicetify.showNotification("Blocklist updated successfully!")});async function B(){if(o){var e=Spicetify.Player.data;if(e&&e.item&&e.item.artists){console.log("[AI Blocker] Current track artists: ",e.item.artists);for(var t of e.item.artists){var i=h(t.uri),t=y.get(i||"")||t.name||"Unknown";if(i&&g.has(i)){i=g.get(i)||[];if(0===i.length){if(!Spicetify.Player.isPlaying())return;if(r){var a=e.item.uri;if(a)try{if(await Spicetify.Platform.LibraryAPI.contains(a))return void console.log(`[AI Blocker] Detected AI Artist: ${t}, but song is liked. Allowing...`)}catch(e){console.error("[AI Blocker] Error checking if song is liked:",e)}}return console.log(`[AI Blocker] Detected AI Artist with no tags: ${t}. Skipping...`),Spicetify.Player.next(),void Spicetify.showNotification("Skipped AI Band: "+t.toUpperCase())}if(i.some(e=>!0===u.get(e))){if(!Spicetify.Player.isPlaying())return;if(r){var n,a=e.item.uri;if(a)try{if(await Spicetify.Platform.LibraryAPI.contains(a))return n=i.filter(e=>!0===u.get(e)),void console.log(`[AI Blocker] Detected AI Artist: ${t} with skippable tags: ${n.join(", ")}, but song is liked. Allowing...`)}catch(e){console.error("[AI Blocker] Error checking if song is liked:",e)}}i=i.filter(e=>!0===u.get(e));return console.log(`[AI Blocker] Detected AI Artist: ${t} with skippable tags: ${i.join(", ")}. Skipping...`),Spicetify.Player.next(),void Spicetify.showNotification(`Skipped AI Band: ${t.toUpperCase()} (${i.join(", ")})`)}}}}}}new Spicetify.Menu.SubMenu("AI Band Blocker",[I,a,x,L,E]).register(),f.register(),m&&i(),Spicetify.Player.addEventListener("songchange",function(){e&&clearTimeout(e),e=setTimeout(B,450)}),B()},(async()=>{await e()})()})();