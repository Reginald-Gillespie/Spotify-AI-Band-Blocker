(async()=>{for(;!Spicetify.React||!Spicetify.ReactDOM;)await new Promise(e=>setTimeout(e,10));var e;e=async function(){for(;null==Spicetify||!Spicetify.Player||null==Spicetify||!Spicetify.Menu||null==Spicetify||!Spicetify.LocalStorage;)await new Promise(e=>setTimeout(e,100));let g={url:"https://raw.githubusercontent.com/romiem/ai-bands/main/dist/ai-bands.json",cacheKey:"ai-bands:list",timeKey:"ai-bands:ts",enabledKey:"ai-bands:enabled",allowLikedKey:"ai-bands:allowLiked",tagSkipStatesKey:"ai-bands:tagSkipStates",showAITagsKey:"ai-bands:showAITags",labelAISongsKey:"ai-bands:labelAISongs",ttl:864e5};(L=document.createElement("style")).textContent=`
    .ai-band-tag {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background-color: #5bcefa;
      color: #000;
      font-size: 10px;
      font-weight: 700;
      padding: 2px 5px;
      border-radius: 3px;
      margin-left: 4px;
      vertical-align: middle;
      line-height: 1;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .ai-band-tag-header {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background-color: #5bcefa;
      color: #000;
      font-size: 24px;
      font-weight: 700;
      padding: 4px 10px;
      border-radius: 6px;
      margin-left: 12px;
      vertical-align: middle;
      line-height: 1;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      position: relative;
      z-index: 10;
    }
    .ai-song-label {
      color: #5bcefa !important;
      font-size: 11px;
      font-weight: 600;
      margin-left: 8px;
      white-space: nowrap;
    }
  `,document.head.appendChild(L);let e,p=new Map,y=new Map,u=new Map,S=new Set,n="false"!==Spicetify.LocalStorage.get(g.enabledKey),r="true"===Spicetify.LocalStorage.get(g.allowLikedKey),m="false"!==Spicetify.LocalStorage.get(g.showAITagsKey),l="false"!==Spicetify.LocalStorage.get(g.labelAISongsKey),t=null;function w(e){return(e=e&&e.match(/artist[\/:]([a-zA-Z0-9]+)/))?e[1]:null}function s(e){return p.has(e)}function c(){var e=document.createElement("span");return e.className="ai-band-tag",e.textContent="AI",e.setAttribute("data-ai-tag","true"),e}function f(){var e=document.createElement("span");return e.className="ai-song-label",e.textContent="AI Artist",e.setAttribute("data-ai-song-label","true"),e.style.flexShrink="0",e}function h(){if(m){var e,t=document.querySelectorAll('a[href*="/artist/"]');let a=null;for(e of Array.from(document.querySelectorAll('a[href*="/artist/"]')))if("show all"===(null==(i=e.textContent)?void 0:i.trim().toLowerCase())){var i=w(e.href);if(i){a=i;break}}t.forEach(e=>{var t,i=e;e.querySelector(".ai-band-tag")||null!=(t=null==(t=e.nextElementSibling)?void 0:t.classList)&&t.contains("ai-band-tag")||!(t=w(i.href))||a&&t===a||s(t)&&(t=y.get(t),i=(null==(i=i.textContent)?void 0:i.trim())||"",/Discovered On|Discovery|You've liked|Show all/i.test(i)||t&&i.toLowerCase()!==t.toLowerCase()||(i=c(),null!=(t=null==(t=e.parentElement)?void 0:t.classList)&&t.contains("encore-text")||e.closest('[data-testid="tracklist-row"]')||e.closest('[data-testid="track-row"]')||e.closest(".main-trackList-trackListRow")?null!=(t=e.parentElement)&&t.insertBefore(i,e.nextSibling):e.appendChild(i)))});var o,t=document.querySelector(".main-entityHeader-title h1, .main-entityHeader-title");!t||t.querySelector(".ai-band-tag")||t.querySelector(".ai-band-tag-header")||a&&s(a)&&((o=c()).classList.remove("ai-band-tag"),o.classList.add("ai-band-tag-header"),t.appendChild(o),t.style.marginBottom="12px",t.style.display="flex",t.style.flexWrap="wrap",t.style.alignItems="center",t.style.gap="12px",o=t.querySelector('[data-encore-id="adaptiveTitle"]'))&&(t=parseFloat(o.style.fontSize)||96,o.style.fontSize=.85*t+"px"),document.querySelectorAll('[data-testid="now-playing-widget"] a[href*="/artist/"], [data-testid="context-item-info-artist"], .main-nowPlayingWidget-nowPlaying a[href*="/artist/"]').forEach(e=>{var t,i;e.querySelector(".ai-band-tag")||null!=(i=null==(i=e.nextElementSibling)?void 0:i.classList)&&i.contains("ai-band-tag")||(t=w((i=e).href))&&s(t)&&(t=y.get(t),i=(null==(i=i.textContent)?void 0:i.trim())||"",t)&&i.toLowerCase()===t.toLowerCase()&&(i=c(),e.appendChild(i))}),l&&document.querySelectorAll('[data-testid="tracklist-row"], [data-testid="track-row"], .main-trackList-trackListRow, [role="row"][aria-rowindex]').forEach(e=>{if(!e.querySelector(".ai-song-label")){var a,o,n=e.querySelectorAll('a[href*="/artist/"]');let t=!1,i=new Set;n.forEach(e=>{e=w(e.href);e&&s(e)&&(e&&i.add(e),t=!0)}),t&&((n=e.querySelector('[data-encore-id="listRowTitle"]'))?(a=f(),n.insertAdjacentElement("beforeend",a)):(a=null==(n=e.querySelector(".main-trackList-rowMainContent"))?void 0:n.querySelector(".encore-text-body-medium"))&&n&&((e=document.createElement("div")).style.display="flex",e.style.alignItems="center",n=f(),o=a.cloneNode(!0),e.appendChild(o),e.appendChild(n),a.replaceWith(e)))}})}}function b(){document.querySelectorAll(".ai-band-tag, .ai-song-label").forEach(e=>e.remove())}function A(){document.querySelectorAll(".ai-band-tag").forEach(e=>e.remove())}function i(){t&&t.disconnect();let e=null;(t=new MutationObserver(()=>{e&&clearTimeout(e),e=setTimeout(()=>{h()},100)})).observe(document.body,{childList:!0,subtree:!0}),h()}function k(){var e=Object.fromEntries(u);Spicetify.LocalStorage.set(g.tagSkipStatesKey,JSON.stringify(e))}if(L=Spicetify.LocalStorage.get(g.tagSkipStatesKey))try{var a=JSON.parse(L);u=new Map(Object.entries(a))}catch(e){console.error("[AI Blocker] Failed to parse tag skip states",e)}let o=[],d;async function v(e){var t=Date.now(),i=Spicetify.LocalStorage.get(g.timeKey),i=i?parseInt(i):0,a=Spicetify.LocalStorage.get(g.cacheKey);let o=[];if(a&&e)try{o=JSON.parse(a)}catch(e){console.error("[AI Blocker] Cache parse error",e)}if(e||t-i>g.ttl||0===o.length){console.log("[AI Blocker] Fetching new blocklist...");try{var n=await fetch(g.url);if(!n.ok)throw new Error("HTTP error! status: "+n.status);0<(o=await n.json()).length&&(Spicetify.LocalStorage.set(g.cacheKey,JSON.stringify(o)),Spicetify.LocalStorage.set(g.timeKey,t.toString()),console.log(`[AI Blocker] Updated cache with ${o.length} artists.`))}catch(e){console.error("[AI Blocker] Fetch failed, using cached data if available.",e)}}p.clear(),y.clear();var r,l,s=new Set;for(r of o){let e,t=[],i=null;if("string"!=typeof r&&("object"==typeof r&&r.name)){e=r.name,t=Array.isArray(r.tags)?r.tags:[];var c=w(i=r.spotify||null);if(c){p.set(c,t),y.set(c,e);for(var f of t)s.add(f)}}}let d=!1;for(l of S=s)u.has(l)||(u.set(l,!0),d=!0);d&&k(),I(),m&&(A(),b(),h())}function I(){o=[];var e=Array.from(u.keys()).filter(e=>S.has(e)).sort();for(let i of e){var t=null==(t=u.get(i))||t,t=new Spicetify.Menu.Item("Skip: "+i,t,e=>{var t=!u.get(i);u.set(i,t),k(),e.setState(t),Spicetify.showNotification(`Tag "${i}" `+(t?"will be skipped":"allowed")),t&&n&&E()});o.push(t)}d&&(d.deregister(),(d=new Spicetify.Menu.SubMenu("AI Filter Tags",o)).register())}await v(!1),setInterval(()=>{console.log("[AI Blocker] Running scheduled ban list update..."),v(!1)},g.ttl),I(),d=new Spicetify.Menu.SubMenu("AI Filter Tags",o);var L=new Spicetify.Menu.Item("Block AI Bands",n,e=>{n=!n,Spicetify.LocalStorage.set(g.enabledKey,n.toString()),e.setState(n),Spicetify.showNotification("AI Blocking "+(n?"ON":"OFF")),n&&E()}),a=new Spicetify.Menu.Item("Allow Liked AI Songs",r,e=>{r=!r,Spicetify.LocalStorage.set(g.allowLikedKey,r.toString()),e.setState(r),Spicetify.showNotification("Allow Liked AI Songs "+(r?"ON":"OFF"))}),x=new Spicetify.Menu.Item("Show AI Tags",m,e=>{m=!m,Spicetify.LocalStorage.set(g.showAITagsKey,m.toString()),e.setState(m),Spicetify.showNotification("AI Tags "+(m?"ON":"OFF")),(m?i:(t&&(t.disconnect(),t=null),A(),b))()}),B=new Spicetify.Menu.Item("Label AI Songs",l,e=>{l=!l,Spicetify.LocalStorage.set(g.labelAISongsKey,l.toString()),e.setState(l),Spicetify.showNotification("AI Song Labels "+(l?"ON":"OFF")),l?h():document.querySelectorAll(".ai-song-label").forEach(e=>e.remove())}),C=new Spicetify.Menu.Item("Update Blocklist",!1,async()=>{var t;Spicetify.showNotification("Updating blocklist..."),await v(!0),t=200,await new Promise(e=>setTimeout(e,t)),Spicetify.showNotification("Blocklist updated successfully!")});async function E(){if(n){var e=Spicetify.Player.data;if(e&&e.item&&e.item.artists){console.log("[AI Blocker] Current track artists: ",e.item.artists);for(var t of e.item.artists){var i=w(t.uri),t=y.get(i||"")||t.name||"Unknown";if(i&&p.has(i)){i=p.get(i)||[];if(0===i.length){if(!Spicetify.Player.isPlaying())return;if(r){var a=e.item.uri;if(a)try{if(await Spicetify.Platform.LibraryAPI.contains(a))return void console.log(`[AI Blocker] Detected AI Artist: ${t}, but song is liked. Allowing...`)}catch(e){console.error("[AI Blocker] Error checking if song is liked:",e)}}return console.log(`[AI Blocker] Detected AI Artist with no tags: ${t}. Skipping...`),Spicetify.Player.next(),void Spicetify.showNotification("Skipped AI Band: "+t.toUpperCase())}if(i.some(e=>!0===u.get(e))){if(!Spicetify.Player.isPlaying())return;if(r){var o,a=e.item.uri;if(a)try{if(await Spicetify.Platform.LibraryAPI.contains(a))return o=i.filter(e=>!0===u.get(e)),void console.log(`[AI Blocker] Detected AI Artist: ${t} with skippable tags: ${o.join(", ")}, but song is liked. Allowing...`)}catch(e){console.error("[AI Blocker] Error checking if song is liked:",e)}}i=i.filter(e=>!0===u.get(e));return console.log(`[AI Blocker] Detected AI Artist: ${t} with skippable tags: ${i.join(", ")}. Skipping...`),Spicetify.Player.next(),void Spicetify.showNotification(`Skipped AI Band: ${t.toUpperCase()} (${i.join(", ")})`)}}}}}}new Spicetify.Menu.SubMenu("AI Band Blocker",[L,a,x,B,C]).register(),d.register(),m&&i(),Spicetify.Player.addEventListener("songchange",function(){e&&clearTimeout(e),e=setTimeout(E,450)}),E()},(async()=>{await e()})()})();