(async()=>{for(;!Spicetify.React||!Spicetify.ReactDOM;)await new Promise(e=>setTimeout(e,10));var e;e=async function(){for(;null==Spicetify||!Spicetify.Player||null==Spicetify||!Spicetify.Menu||null==Spicetify||!Spicetify.LocalStorage;)await new Promise(e=>setTimeout(e,100));let n={url:"https://raw.githubusercontent.com/romiem/ai-bands/main/dist/ai-bands.json",cacheKey:"ai-bands:list",timeKey:"ai-bands:ts",enabledKey:"ai-bands:enabled",allowLikedKey:"ai-bands:allowLiked",ttl:864e5},e,r=new Set,i="true"===Spicetify.LocalStorage.get(n.enabledKey),a="true"===Spicetify.LocalStorage.get(n.allowLikedKey);async function t(){var e=Date.now(),t=Spicetify.LocalStorage.get(n.timeKey),t=t?parseInt(t):0,i=Spicetify.LocalStorage.get(n.cacheKey);let a=[];if(i)try{a=JSON.parse(i)}catch(e){console.error("[AI Blocker] Cache parse error",e)}if(e-t>n.ttl||0===a.length){console.log("[AI Blocker] Fetching new blocklist...");try{var o=await fetch(n.url);if(!o.ok)throw new Error("HTTP error! status: "+o.status);var c=(await o.json()).map(e=>"string"==typeof e?e:"object"==typeof e&&e.name?e.name:null).filter(e=>null!==e);0<c.length&&(a=c,Spicetify.LocalStorage.set(n.cacheKey,JSON.stringify(a)),Spicetify.LocalStorage.set(n.timeKey,e.toString()),console.log(`[AI Blocker] Updated cache with ${a.length} artists.`))}catch(e){console.error("[AI Blocker] Fetch failed, using cached data if available.",e)}}r=new Set(a.map(e=>e.toLowerCase().trim()))}await t(),setInterval(()=>{console.log("[AI Blocker] Running scheduled ban list update..."),t()},n.ttl);var o=new Spicetify.Menu.Item("Block AI Bands",i,e=>{i=!i,Spicetify.LocalStorage.set(n.enabledKey,i.toString()),e.setState(i),Spicetify.showNotification("AI Blocking "+(i?"ON":"OFF")),i&&l()}),c=new Spicetify.Menu.Item("Allow Liked AI Songs",a,e=>{a=!a,Spicetify.LocalStorage.set(n.allowLikedKey,a.toString()),e.setState(a),Spicetify.showNotification("Allow Liked AI Songs "+(a?"ON":"OFF"))});async function l(){if(i){var e=Spicetify.Player.data;if(console.log(e.item.artists),e&&e.item&&e.item.artists){var t=e.item.artists.map(e=>e.name.toLowerCase().trim()).find(e=>r.has(e));if(t&&Spicetify.Player.isPlaying()){if(a){e=e.item.uri;if(e)try{if(await Spicetify.Platform.LibraryAPI.contains(e))return void console.log(`[AI Blocker] Detected AI Artist: ${t}, but song is liked. Allowing...`)}catch(e){console.error("[AI Blocker] Error checking if song is liked:",e)}}console.log(`[AI Blocker] Detected AI Artist: ${t}. Skipping...`),Spicetify.Player.next(),Spicetify.showNotification("Skipped AI Band: "+t.toUpperCase())}}}}new Spicetify.Menu.SubMenu("AI Band Blocker",[o,c]).register(),Spicetify.Player.addEventListener("songchange",function(){e&&clearTimeout(e),e=setTimeout(l,450)}),l()},(async()=>{await e()})()})();